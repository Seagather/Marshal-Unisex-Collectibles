{% extends "base.html" %}
{% load static %}

{% block page_header %}
    <div class="container header-container">
        <div class="row">
            <div class="col"></div>
        </div>
    </div>
{% endblock %}

{% block content %}
    <div class="overlay"></div>
    <div class="container-fluid">
        <div class="row">
            <!-- Product Image -->
            <div class="col-12 col-md-6 col-lg-4 offset-lg-2">
                <div class="image-container my-5">
                    {% if product.image %}
                        <a href="{{ product.image.url }}" target="_blank">
                            <img class="card-img-top img-fluid" src="{{ product.image.url }}" alt="{{ product.name }}">
                        </a>
                        {% else %}
                        <a href="">
                            <img class="card-img-top img-fluid" src="{{ MEDIA_URL }}noimage.png" alt="{{ product.name }}">
                        </a>
                    {% endif %}
                </div>
            </div>
            <!-- Product details -->
            <div class="col-12 col-md-6 col-lg-4">
                <div class="product-details-container mb-5 mt-md-5">
                    <p class="mb-0 product-name">{{ product.name }}</p>
                    <p class="lead mb-0 text-left font-weight-bold">${{ product.price }}</p>
                    {% if product.category %}
                    <p class="small mt-1 mb-0">
                        <a class="text-muted" href="{% url 'products' %}?category={{ product.category.name }}">
                            <i class="fas fa-tag mr-1"></i>{{ product.category.friendly_name }}
                        </a>
                    </p>
                    {% endif %}
                    {% if product.rating %}
                        <small class="text-muted"><i class="fas fa-star mr-1"></i>{{ product.rating }} / 5</small>
                    {% else %}
                        <small class="text-muted">No Rating</small>
                    {% endif %}
                    {% if request.user.is_superuser %}
                        <small class="ml-3">
                            <a href="{% url 'edit_product' product.id %}">Edit</a> | 
                            <a class="text-danger" href="{% url 'delete_product' product.id %}">Delete</a>
                        </small>
                    {% endif %}
                    <p class="mt-3">{{ product.description }}</p>
                    <form class="form" action="{% url 'add_to_bag' product.id %}" method="POST">
                        {% csrf_token %}
                        <div class="form-row">
                            {% with product.size_adjustment as s %}
                            {% if s %}
                                <div class="col-12">
                                    <p><strong>Size Adjustment:</strong></p>
                                    <select class="form-control rounded-0 w-50" name="product_size" id="id_product_size">
                                        <option value="without size adjustment">NO SIZE ADJUSTMENT</option>
                                        <option value="15.00 cm">15.00 CM</option>
                                        <option value="15.50 cm">15.50 CM</option>
                                        <option value="16.00 cm">16.00 CM</option>
                                        <option value="16.50 cm">16.50 CM</option>
                                        <option value="17.00 cm">17.00 CM</option>
                                        <option value="17.50 cm">17.50 CM</option>
                                        <option value="18.00 cm">18.80 CM</option>
                                        <option value="18.50 cm">18.50 CM</option>
                                        <option value="19.00 cm">19.00 CM</option>
                                        <option value="19.50 cm">19.50 CM</option>
                                        <option value="20.00 cm">20.00 CM</option>
                                    </select>
                                </div>
                            {% endif %}
                            <div class="col-12">
                                <p class="mt-3"><strong>Quantity:</strong></p>
                                <div class="form-group w-50">
                                    <div class="input-group">
                                        <div class="input-group-prepend">
                                            <button class="decrement-qty btn btn-black rounded-0" 
                                                data-item_id="{{ product.id }}" id="decrement-qty_{{ product.id }}">
                                                <span class="icon">
                                                    <i class="fas fa-minus"></i>
                                                </span>
                                            </button>
                                        </div>
                                        <input class="form-control qty_input" type="number"
                                            name="quantity" value="1" min="1" max="99"
                                            data-item_id="{{ product.id }}"
                                            id="id_qty_{{ product.id }}">
                                        <div class="input-group-append">
                                            <button class="increment-qty btn btn-black rounded-0"
                                                data-item_id="{{ product.id }}" id="increment-qty_{{ product.id }}">
                                                <span class="icon">
                                                    <i class="fas fa-plus"></i>
                                                </span>
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col{% if s %}-12 mt-2{% endif %}">
                                <a href="{% url 'products' %}" class="btn btn-outline-black rounded-0 mt-5">
                                    <span class="icon">
                                        <i class="fas fa-chevron-left"></i>
                                    </span>
                                    <span class="text-uppercase">Keep Shopping</span>
                                </a>
                                <button type="submit" class="btn btn-black rounded-0 text-uppercase mt-5"><i class="fas fa-shopping-bag mr-2"></i>Add to Bag</button>
                            </div>
                            <input type="hidden" name="redirect_url" value="{{ request.path }}">
                            {% endwith %}
                        </div>
                    </form>
                </div>
            </div>
            <!-- Reviews section -->
            <div class="col-12 col-md-8 offset-md-2">
                <div class="bg-light px-4 py-2 text-uppercase text-center font-weight-bold">Product Reviews</div>
                <div class="p-0">
                    {% if not review %}
                        <div class="row">
                            <div class="col-10 offset-1 text-center">
                                <hr>
                                <p class="text-center text-muted">No reviews</p>
                                <hr>
                            </div>
                        </div>
                    {% else %}
                        {% for review in review %}
                            <div class="row">
                                <div class="col-10 offset-1 text-center">
                                    <div class="review-container p-2 my-2">
                                        <p class="review-title font-weight-bold text-black">{{ review.title }}</p>
                                        <p class="review-body">{{ review.body }}</p>
                                        <p class="text-muted my-0"><small>Review left by <strong>{{ review.user }}</strong> on {{ review.timestamp }}</small></p>
                                    </div>
                                    <hr>
                                </div>
                            </div>
                        {% endfor %}
                    {% endif %}
                </div>
                <p class="text-muted mb-3 text-center"><em>Thank you so much for taking the time to provide feedback for your purchased products! If you are happy with your new product, let us know what keeps you coming back for more! You can leave us a review via your order history profile.</em></p>
            </div>
        </div>
    </div>
        <!-- </div> -->
    <!-- </div> -->
{% endblock %}

{% block postloadjs %}
{{ block.super }}
{% include 'products/includes/quantity_input_script.html' %}
{% endblock %}